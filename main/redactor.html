<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Pixi + Matter.js</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <!-- PixiJS -->
    <script src="https://pixijs.download/release/pixi.min.js"></script>
    <!-- Matter.js -->
    <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>

    <script type="module">
      const app = new PIXI.Application();
      await app.init({ width: 640, height: 360, background: "#202020" });
      document.body.appendChild(app.canvas);

      const Engine = Matter.Engine,
        World = Matter.World,
        Bodies = Matter.Bodies;

      const engine = Engine.create();
      const world = engine.world;

      function createRect(
        x,
        y,
        width,
        height,
        color = 0xff3333,
        isStatic = false
      ) {
        const body = Bodies.rectangle(x, y, width, height, { isStatic });
        World.add(world, body);

        const graphics = new PIXI.Graphics();
        graphics.beginFill(color);
        graphics.drawRect(-width / 2, -height / 2, width, height);
        graphics.endFill();
        graphics.x = x;
        graphics.y = y;
        app.stage.addChild(graphics);

        return { body, graphics };
      }

      function createCircle(x, y, radius, color = 0x33aaff, isStatic = false) {
        const body = Bodies.circle(x, y, radius, { isStatic });
        World.add(world, body);

        const graphics = new PIXI.Graphics();
        graphics.beginFill(color);
        graphics.drawCircle(0, 0, radius);
        graphics.endFill();
        graphics.x = x;
        graphics.y = y;
        app.stage.addChild(graphics);

        return { body, graphics };
      }

      function createImg(x, y, path, isStatic) {}

      // Об'єкти
      const box = createRect(320, 50, 50, 50);
      const ground = createRect(320, 340, 640, 40, "lightgreen", true);
      const sun = createCircle(50, 50, 30, 0xffff00, true);

      // Масив всіх об'єктів, які мають бути оновлені
      const objects = [box, ground, sun];

      app.ticker.add(() => {
        Engine.update(engine, app.ticker.deltaMS);

        for (const obj of objects) {
          obj.graphics.x = obj.body.position.x;
          obj.graphics.y = obj.body.position.y;
          obj.graphics.rotation = obj.body.angle;
        }
      });
    </script>
  </body>
</html>
